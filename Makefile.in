CXX = @CXX@
LEX = @LEX@
YACC = @YACC@
TAGLIB_ROOT = @TAGLIB_ROOT@
DEFS = -DNDEBUG

CXXFLAGS = @CXXFLAGS@ $(INCLUDES) $(DEFS)
INCLUDES = -I$(TAGLIB_ROOT)/include/taglib

SRCS_C = lex.yy.c y.tab.c
SRCS_CXX = tagreport.cc templates.cc util.cc
OBJS = $(SRCS_C:.c=.o) $(SRCS_CXX:.cc=.o)
LIBS = -L$(TAGLIB_ROOT)/lib -ltag

all: tagreport

%.o: %.c
	$(CXX) $(CXXFLAGS) -c $< -o $@

%.o: %.cc
	$(CXX) $(CXXFLAGS) -c $< -o $@

tagreport: $(OBJS)
	$(CXX) $(CXXFLAGS) $(OBJS) -o $@ $(LIBS)

lex.yy.c: format.l
	$(LEX) $<

y.tab.c: format.y
	$(YACC) -d $<

y.tab.h: y.tab.c

lex.yy.c: templates.h y.tab.h
y.tab.c: templates.h

.depend: $(SRCS_CXX)
	$(CXX) -MM $(SRCS_CXX) > .depend

clean:
	rm -f tagreport *.o core a.out lex.yy.c y.tab.c y.tab.h *~

distclean: clean
	rm -f Makefile config.status config.log config.h
	rm -rf autom4te.cache
	
-include .depend

.PHONY: distclean clean all
